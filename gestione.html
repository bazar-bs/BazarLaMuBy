<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Pannello Articoli Locale</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f8f8; }
    h1 { color: #6e3b6e; }
    .articolo { background: #fff; padding: 15px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; }
    .articolo input { width: 100%; margin: 4px 0; padding: 6px; }
    .articolo button { background: #c0392b; color: #fff; border: none; padding: 6px 10px; margin-top: 5px; border-radius: 4px; cursor: pointer; }
    .articolo button:hover { background: #e74c3c; }
    #aggiungi, #carica, #salva { margin-top: 10px; padding: 10px; border: none; border-radius: 5px; color: #fff; cursor: pointer; }
    #carica { background: #f39c12; }
    #aggiungi { background: #27ae60; }
    #salva { background: #2980b9; }
    textarea { width: 100%; height: 100px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Gestione Articoli (Modalità Locale)</h1>
  <input type="file" id="fileInput" accept=".json" />
  <button id="carica">📂 Carica File JSON</button>
  <div id="contenitore"></div>
  <button id="aggiungi">➕ Aggiungi Articolo</button>
  <button id="salva">💾 Esporta JSON</button>
  <textarea id="output" readonly></textarea>

  <script>
    let articoli = [];

    document.getElementById('carica').onclick = () => {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files[0]) return alert('Seleziona prima un file!');
      const reader = new FileReader();
      reader.onload = () => {
        try {
          articoli = JSON.parse(reader.result);
          render();
        } catch (e) {
          alert('File non valido!');
        }
      };
      reader.readAsText(fileInput.files[0]);
    };

    function render() {
      const c = document.getElementById('contenitore');
      c.innerHTML = '';
      articoli.forEach((a, i) => {
        const div = document.createElement('div');
        div.className = 'articolo';
        div.innerHTML = `
          <input value="${a.id}" placeholder="ID" onchange="aggiorna(${i}, 'id', this.value)" />
          <input value="${a.titolo}" placeholder="Titolo" onchange="aggiorna(${i}, 'titolo', this.value)" />
          <input value="${a.descrizione}" placeholder="Descrizione" onchange="aggiorna(${i}, 'descrizione', this.value)" />
          <input value="${a.prezzo}" placeholder="Prezzo" onchange="aggiorna(${i}, 'prezzo', this.value)" />
          <input value="${a.foto1}" placeholder="Foto 1" onchange="aggiorna(${i}, 'foto1', this.value)" />
          <input value="${a.foto2}" placeholder="Foto 2" onchange="aggiorna(${i}, 'foto2', this.value)" />
          <input value="${a.badge}" placeholder="Badge" onchange="aggiorna(${i}, 'badge', this.value)" />
          <button onclick="elimina(${i})">🗑️ Elimina</button>
        `;
        c.appendChild(div);
      });
    }

    function aggiorna(i, campo, val) {
      articoli[i][campo] = val;
    }

    function elimina(i) {
      if (confirm('Eliminare questo articolo?')) {
        articoli.splice(i, 1);
        render();
      }
    }

    document.getElementById('aggiungi').onclick = () => {
      articoli.push({
        id: articoli.length + 1,
        titolo: '',
        descrizione: '',
        prezzo: '',
        foto1: '',
        foto2: '',
        badge: ''
      });
      render();
    };

    document.getElementById('salva').onclick = () => {
  const json = JSON.stringify(articoli, null, 2);
  document.getElementById('output').value = json;

  // ⏱️ Crea un nome con data e ora
  const now = new Date();
  const timestamp = now.toISOString().replace(/[:.]/g, '-');
  const backupName = `articoli-backup-${timestamp}.json`;

  // 📦 Crea il blob da salvare
  const blob = new Blob([json], { type: 'application/json' });

  // 💾 Salva prima il backup
  const linkBackup = document.createElement('a');
  linkBackup.href = URL.createObjectURL(blob);
  linkBackup.download = backupName;
  linkBackup.click();

  // 💾 Poi salva il file principale
  const linkMain = document.createElement('a');
  linkMain.href = URL.createObjectURL(blob);
  linkMain.download = 'articoli.json';
  linkMain.click();
};

  </script>
</body>
</html>
