<!DOCTYPE html>
<html lang="it">
<head>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="manifest" href="./manifest.json">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css?v=2"
      as="style" crossorigin onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css?v=2"></noscript>
  <meta charset="UTF-8">
  <meta name="description" content="Il bAzAr LaMuBy è un bazar online di articoli usati, unici e convenienti. Scopri offerte, oggetti rari e occasioni imperdibili.">
  <meta name="keywords" content="bazar online, articoli usati, oggetti usati, offerte usato, articoli vintage, occasioni, mercatino, LaMuBy, compra usato, oggetti da collezione">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>il bAzAr LaMuBy</title>  
<link rel="stylesheet" href="style.css?v=1.0">
<link rel="preload" as="image" href="lamuby_logo_bigtext.avif" fetchpriority="high">
</head>
<body>
<canvas id="fireworks-canvas" style="position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:9998; display:none;"></canvas>
<audio id="suono-aggiunta" src="add-to-cart-soft-pop.mp3" preload="auto"></audio>
	<!-- Loader -->
<div id="loader">
  <div class="spinner"></div>
  <p>Caricamento articoli...</p>
</div>
<div id="toggle-sidebar" class="toggle-sidebar" title="Apri preferiti">
  ❤️
</div>
<!-- Pulsante Carrello Piccolo (nascosto di default) -->
<button id="carrello-btn-small" class="btn-carrello-small" onclick="mostraCarrello()" aria-label="Apri il carrello" title="Carrello">
  <div class="carrello-icon-wrapper">
    <i class="fas fa-luggage-cart"></i>
    <span id="badge-carrello-small">0</span>
  </div>
</button>
<!-- Sidebar destra -->
<div id="sidebar" class="sidebar">
  <button id="close-sidebar" class="close-btn" title="Chiudi">
	<i class="fas fa-times" ></i>
  </button>
  <nav class="sidebar-menu">    
  </nav>
  <!-- ✅ Qui va la lista dei preferiti -->
  <div class="preferiti-box">
  <img src="lamuby_logo_bigtext_trasp_bianco.png" alt="Logo LaMuBy" class="logosidebar">
    <h2 id="messaggio-bentornato">
      <span id="nome-utente" style="cursor:pointer;">
       <span id="saluto-label">Benvenuto</span> <span id="username-dinamico">Utente</span>
       <span id="icona-modifica" title="Clicca per cambiare nome" style="font-size: 1rem; margin-left: 6px;">✏️</span>
      </span>
    </h2>
	<h3>I tuoi preferiti ❤️</h3>
		<ul id="lista-preferiti"></ul>
	<h3 class="bottone-ordini" onclick="toggleOrdini()" aria-label="Visualizza ordini salvati" title="Visualizza ordini salvati">
		I tuoi ordini 📦 <span class="clicca-qui">(clicca qui)</span> <span id="freccia" class="freccia">⬇️</span>
    </h3>
    <ul id="lista-ordini" style="display: none;"></ul>	
  </div>
  <!-- ✅ Footer versione, fissato in fondo -->
  <div class="sidebar-footer">
	<h4 style="text-align: center; opacity: 0.6;">
		<i class="fas fa-tag"></i> Ver. 1.06
	</h4>
  </div>
</div>
<!-- Overlay per chiudere cliccando fuori -->
<div id="sidebar-overlay" class="sidebar-overlay"></div>
	<div id="popup-annullato" class="modal">
		    <h2>❌ Ordine Annullato</h2>
		    <p>😅Hai annullato il tuo ordine! Stai per tornare al carrello.</p> 
		    <button onclick="chiudiPopupAnnullato()" style="background: #6e3b6e; color: white; padding: 0.8rem; border: none; border-radius: 5px; cursor: pointer; display: block; margin: 15px auto 0;">
		    <i class="fas fa-times-circle"></i> Chiudi</button>
	</div>
	<div id="easter-egg-modal" class="modal">
    <h2>🎉Easter Egg!🎉</h2>
    <p class="evidenziato">
        Hai trovato il segreto nascosto...👀  
        <span class="nome-antimo">Antimo</span> è la mente geniale dietro tutto questo: creatore e sviluppatore del sito!💻
    </p>
	<img src="LogoVendiLite2(192).avif" alt="VendiLite logo"
		style="position: absolute; bottom: 10px; right: 10px; width: 80px; height: 80px; opacity: 0.8;" />
    <button onclick="chiudiModal()"><i class="fas fa-times-circle"></i> Chiudi</button>
</div>
<header>
	  <div class="header-content">
		    <img src="lamuby_logo_bigtext.avif" alt="Logo LaMuBy" class="logo">
		    <div>
		      <h1 class="animated-title">il bAzAr LaMuBy</h1>
		      <p class="animated-subtitle">-Articoli usati Occasioni online-</p>
		    </div>
	  </div>
</header>
	<div style="display: flex; justify-content: center; gap: 10px; margin: 1rem auto;">		
		<!-- Pulsante Ordina per Prezzo -->
		<button onclick="toggleOrdinaPrezzo()" id="ordina-prezzo-btn"
			class="btn-ordina-prezzo"
			aria-label="Ordina gli articoli per prezzo"
			title="Ordina per prezzo">
			<i class="fas fa-long-arrow-alt-up"><sup>€</sup></i>
		</button>	
		<!-- Pulsante Home -->
		<button onclick="tornaAllaHome()" id="home-btn"
			class="btn-home"
			aria-label="Torna alla Home"
			title="Torna alla Home">
			<i class="fas fa-home"></i>
		</button>	
		<!-- Pulsante Carrello -->
		<button onclick="mostraCarrello()" id="carrello-btn"
			aria-label="Visualizza Carrello"
			title="Visualizza Carrello">
			<i class="fas fa-shopping-cart"></i> Carrello (<span id="contatore-carrello">0</span>)
		</button>
	</div>
  <div class="container">
		<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0rem;">
		<div class="search-container" style="display: flex; flex-direction: row; align-items: flex-start; position: relative;">
  <h2 id="titolo-home">Articoli <span id="contatore-articoli">(0)</span>&nbsp;&nbsp;</h2>
  <div class="search-wrapper">
    <input type="text" id="search" placeholder="🔍Cerca articoli..." />
    <span id="clear-search" title="Cancella" style="display:none;">&times;</span>
  </div>
</div>	    
		<!-- Overlay oscurante -->
		<div id="overlay-carrello" class="overlay"></div>	
		<!-- Finestra centrale del carrello -->
<div id="modal-carrello" class="modal">
  <div class="contenitore-carrello-pagina">
    <div class="contenitore-carrello">
      <i class="fas fa-luggage-cart icona-animata-carrello"></i>
      <span id="contatore-carrello-modal">0</span>
    </div>
  </div>
<p style="text-align: center; font-size: 1.1rem; background-color: #f2f2f2; padding: 10px; border-radius: 6px;">
    Gli ordini vengono gestiti direttamente su 
    <strong style="background-color: yellow; padding: 2px;">
        <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
    </strong>
</p>
  <h2 style="text-align: center;">Il Carrello</h2>
  <ul id="lista-carrello" style="list-style: none; padding: 0;"></ul>
  <p id="totale-prezzo" style="text-align: center; font-weight: bold; font-size: 1.4rem; margin-top: 10px;">Totale: €0.00</p>
  <!-- 🔁 Bottoni aggiornati -->
  <div class="bottoni-carrello">
    <button id="btn-svuota" onclick="svuotaCarrello()" aria-label="Svuota il carrello" title="Svuota il carrello">
      <i class="fas fa-trash"></i> Svuota
    </button>
    <button id="btn-procedi" onclick="mostraModuloSpedizione()" aria-label="Procedi" title="Procedi">
      <i class="fas fa-arrow-right"></i> Procedi
    </button>
  </div>
  <button onclick="chiudiCarrello()" class="btn-chiudi-carrello" aria-label="Chiudi il carrello" title="Chiudi il carrello">
	<i class="fas fa-times-circle"></i> Chiudi
  </button>
</div>
<!-- Finestra Modulo Spedizione -->
<div id="modal-spedizione" class="modal">
<div class="contenitore-spedizione">
  <i class="fas fa-truck icona-animata-spedizione"></i>
  <div class="nuvoletta"></div>
</div>
    <h2 style="margin-bottom: 2px;">Inserisci i dati di spedizione</h2>
	<h4 style="margin-top: 2px; opacity: 0.5;">recupero dati</h4>
    <form id="form-spedizione">
    <input type="text" id="nome" placeholder="Nome e Cognome" required>
    <input type="text" id="indirizzo" placeholder="Indirizzo (Via Rossi 10 Milano MI 20100)" required>
    <input type="tel" id="telefono" placeholder="Telefono" required>
    <input type="email" id="email" placeholder="Email" required>
<!-- Salva i dati della spedizione nel browser -->
<label 
  style="display: inline-flex; align-items: center; font-size: 14px;" 
  title="Seleziona per salvare i dati della spedizione nel browser">  
  <i class="fas fa-save" 
     style="margin-right: 2px; font-size: 14px;" 
     aria-label="Icona Salva dati" 
     title="Salva i dati" 
     aria-hidden="true"></i>
  <input type="checkbox" 
         style="margin: 0 2px; width: 14px; height: 14px;" 
         id="consenso-salvataggio" 
         aria-label="Checkbox per salvare i dati della spedizione" />
  <span style="margin: 0; padding: 0;" 
        aria-label="Testo: Salva i dati della spedizione">
    Salva i dati
  </span>
</label>
<!-- Bottone Continua -->
<button type="button" onclick="apriRiepilogo()" aria-label="Continua" title="Continua" class="btn-continua"> 
  <i class="fas fa-arrow-right"></i> Continua
</button>
	</form>
    <button onclick="chiudiModuloSpedizione()" aria-label="Chiudi" title="Chiudi" class="chiudi-modulo-spedizione">
		<i class="fas fa-times-circle"></i> Chiudi
    </button>
</div>
<!-- Modale Riepilogo Ordine -->
<div id="modal-riepilogo" class="modal" style="display: none;">
  <h2 style="margin-bottom: 2px;">📋Riepilogo dell'Ordine</h2>
  <h4 style="margin-top: 2px;">
	Verifica i dati, dopo l’invio riceverai Info per il pagamento 
	<!-- <i class="fab fa-paypal" style="margin-right: 4px;"></i> -->
	<!-- PayPal -->
  </h4>
  <!-- Carrello -->
  <div id="riepilogo-carrello" style="margin-bottom: 15px;">
    <h3>🛒 Carrello</h3>
    <ul id="riepilogo-lista-carrello" style="list-style: disc; padding: 0;"></ul>
    <p id="riepilogo-totale" style="font-weight: bold; font-size: 1.2rem;"></p>
  </div>
  <!-- Spedizione -->
  <div id="riepilogo-spedizione" style="margin-bottom: 15px;">
    <h3>🚚 Dati Spedizione</h3>
    <p><strong>Nome:</strong> <span id="riepilogo-nome"></span></p>
    <p><strong>Indirizzo:</strong> <span id="riepilogo-indirizzo"></span></p>
    <p><strong>Telefono:</strong> <span id="riepilogo-telefono"></span></p>
    <p><strong>Email:</strong> <span id="riepilogo-email"></span></p>
  </div>
<!-- Pulsante WhatsApp centrato in alto -->
<div class="invia-whatsapp-container">
  <button type="button" onclick="inviaOrdineWhatsApp()" aria-label="Conferma e Invio Ordine" title="Conferma e Invio Ordine" class="btn-invia-whatsapp">
    <i class="fab fa-whatsapp"></i> Invia Ordine via WhatsApp
  </button>
</div>
<!-- Pulsanti Indietro e Annulla affiancati sotto -->
<div class="btn-group">
  <button onclick="tornaAllaSpedizione()" aria-label="Torna alla Spedizione" title="Torna alla Spedizione" class="btn btn-indietro">
    <i class="fas fa-arrow-left"></i> Indietro
  </button>
  <button onclick="chiudiModuloRiepilogo()" aria-label="Annulla Ordine" title="Annulla Ordine" class="btn btn-annulla">
    <i class="fas fa-times-circle"></i> Annulla
  </button>
</div>
</div>
<!-- Popup di conferma ordine -->
<div id="popup-conferma" class="modal">
    <h2>✅ Ordine Confermato!</h2>
    <p>😄Grazie per il tuo acquisto! Ti contatteremo a breve...</p>
    <!-- Bottone Mostra Link Pagamento PayPal -->
    <!-- <button type="button" onclick="mostraLinkPagamento()" class="btn-paypal" aria-label="Mostra link PayPal" title="Mostra link PayPal"> -->
      <!-- <i class="fab fa-paypal"></i> Paga ora con PayPal -->
    <!-- </button> -->
    <!-- Bottone Chiudi -->
    <button onclick="chiudiPopupConferma()" class="btn-chiudi-popup">
      <i class="fas fa-times-circle"></i> Chiudi
    </button>
</div>
  </div>
    <div class="products">  
    </div>
    <!-- Dettaglio Articolo -->
    <div id="dettaglio-articolo" style="display:none; background: white; padding: 1rem; border-radius: 8px;position: relative;">   
      <div id="badge-articolo" style="position: absolute; top: 0; left: 0; background-color: #6e3b6e; color: white; font-size: 0.7rem; padding: 4px 10px; font-weight: bold; border-bottom-right-radius: 8px;"></div>
      <button id="share-btn" aria-label="Condividi" title="Condividi" style="position: absolute; top: 0; right: 0; background: none; border: none; font-size: 1.3rem; color: #6e3b6e; padding: 10px; cursor: pointer;">
      <i class="fas fa-share-alt"></i>
      </button>
	  <h2 id="titolo-articolo"></h2>
      <div id="prezzo-container" style="display: flex; align-items: center; gap: 8px; font-weight: bold; font-size: 1.2rem;">
		<p id="prezzo-articolo" class="price" style="margin: 0;"></p>
		<i class="fas fa-tag icon-load" style="font-size: 1.6rem; color: black;"></i>
	  </div>
      <p id="descrizione-articolo"></p>
      <p style="margin: 1rem 0; text-align: left;">
      <span class="highlight-blink">Info e disponibilità usa Contattaci<br>in fondo alla pagina</span>
      </p>
      <div class="detail-image" aria-label="Apri immagine 1 ingrandita">
		<img id="foto1-articolo" src="immagine-non-disponibile.webp" loading="lazy" alt="Foto principale dell'articolo">
		<i class="fas fa-search img-zoom-icon" aria-hidden="true"></i>
	  </div>
	  <div class="detail-image" aria-label="Apri immagine 2 ingrandita">
		<img id="foto2-articolo" src="immagine-non-disponibile.webp" loading="lazy" alt="Foto aggiuntiva dell'articolo">
        <i class="fas fa-search img-zoom-icon" aria-hidden="true"></i>
	  </div>
<!-- Nuovo bottone per aggiungere al carrello -->
  <button onclick="aggiungiAlCarrello(document.getElementById('titolo-articolo').textContent, document.getElementById('prezzo-articolo').textContent)" class="contact-button" aria-label="Aggiungi al carrello" title="Aggiungi al carrello">
    <i class="fas fa-shopping-cart"></i> Aggiungi al Carrello
</button>
<p id="conferma-aggiunta" style="display: none; color: #6e3b6e; font-weight: bold; text-align: center;"></p>
<button onclick="tornaAllaHome()" class="contact-button" aria-label="Torna alla Home" title="Torna alla Home">
    <i class="fas fa-home"></i> Torna alla home
</button>
    </div>
<button class="contact-button" onclick="toggleModal()" aria-label="Contattaci" title="Contattaci">
    <i class="fas fa-envelope"></i> Contattaci<br>
	<i class="fas fa-question-circle"></i> FAQ
</button>
  </div>  
<!--nuovo pulsante per installare app-->  
<button class="contact-button" onclick="toggleAppModal()" aria-label="Info APP" title="Info APP">
  <i class="fas fa-mobile-alt"></i> App
</button>
  <div class="modal" id="modal" onclick="toggleModal()">
  <!-- Bottone "X" solo decorativo -->
<button class="close-btn" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 1.3rem; color: #6e3b6e; cursor: pointer;" title="Chiudi">
  <i class="fas fa-times"></i>
</button>
  <h3>Chi siamo</h3>
  <!-- Inserimento QR Code sopra le informazioni di contatto -->
  <div style="text-align: center; margin-top: -1rem; margin-bottom: -1rem">
      <img src="qr-lamuby.png" alt="QR Code LaMuBy" style="width: 120px; height: 120px;">
  </div>
  <p>Siamo un piccolo bazar online dedicato alla vendita di articoli usati. La nostra missione è dare una seconda vita agli oggetti e offrire buone occasioni a chi cerca qualcosa di unico.</p>
  <p>Contattaci per disponibilità, spedizioni e maggiori informazioni sui prodotti!</p>
  <p>
  <b><i class="fab fa-whatsapp"></i> Telefono: 
    <span id="telefonopersonale" onclick="copiaContatto('telefonopersonale')" style="cursor: pointer;" title="Clicca per copiare"></span>
  </b>
</p>
<p>
  <b><i class="fas fa-envelope"></i> Email: 
    <span id="emailpersonale" onclick="copiaContatto('emailpersonale')" style="cursor: pointer;" title="Clicca per copiare"></span>
  </b>
</p>
<!-- Pulsante per aprire il modale privacy -->
<button onclick="togglePolicyModal()" class="btn btn-privacy" aria-label="Privacy & Cookie Policy" title="Privacy & Cookie Policy">
  <i class="fas fa-shield-alt"></i> Privacy & Cookie Policy
</button>
<!-- <button onclick="togglePagamentoSpedizioneModal()" class="btn btn-pagamento" aria-label="Info Pagamento e Spedizione" title="Info Pagamento e Spedizione"> -->
  <!-- <i class="fas fa-info-circle"></i> Pagamento & Spedizione -->
<!-- </button> -->
</div>
<!-- Modale Privacy Policy -->
<div id="modal-policy" class="modal">
  <h3>Privacy & Cookie Policy</h3>
  <p><strong><i class="fas fa-database"></i> Raccolta dati:</strong><br>
    Non raccogliamo dati personali in modo automatico.Gli ordini inviati tramite WhatsApp sono gestiti manualmente e non vengono archiviati online.I dati(preferiti,ordini)vengono salvati localmente sul dispositivo,previo consenso per il salvataggio delle informazioni di spedizione.
  </p>
  <p><strong><i class="fab fa-whatsapp" style="color:#25D366;"></i> Ordini via WhatsApp:</strong><br>
    Se invii un ordine tramite WhatsApp,i tuoi dati saranno visibili solo al titolare del bAzAr LaMuBy per finalità legate alla spedizione.Non saranno condivisi o archiviati digitalmente.
  </p>
  <p><strong><i class="fas fa-cookie-bite"></i> Cookie:</strong><br>
    Questo sito non utilizza cookie di profilazione,pubblicità o tecnici.
  </p>
  <button onclick="togglePolicyModal()" style="background: #6e3b6e; color: white; padding: 0.8rem; border: none; border-radius: 5px; cursor: pointer;">
    <i class="fas fa-times-circle"></i> Chiudi</button>
</div>
<!-- Overlay per la policy -->
<div id="policy-overlay" class="overlay" onclick="togglePolicyModal()"></div>
<!-- Modal Info Pagamento e Spedizione -->
<div class="modal" id="modal-pagamento-spedizione">
  <h3>Info Pagamento e Spedizione</h3>
  <p><strong>Pagamento PayPal.me:</strong> Puoi effettuare il pagamento in modo sicuro tramite il nostro link personalizzato PayPal.me. Ti forniremo il link dopo la conferma dell’ordine.</p>
  <p>⚠️ ""Se non hai il link PayPal.me per il pagamento, puoi richiederlo direttamente via chat su WhatsApp.""</p>
  <hr>
  <p><strong>Spedizione:</strong> Gli ordini vengono elaborati entro 1-2 giorni lavorativi. Le spedizioni sono gestite tramite corriere tracciabile e riceverai un codice di tracking via email.</p>
  <button onclick="togglePagamentoSpedizioneModal()" style="background: #6e3b6e; color: white; padding: 0.8rem; border: none; border-radius: 5px; cursor: pointer;">
    <i class="fas fa-times-circle"></i> Chiudi</button>
</div>
<!-- Overlay per info spedizione e pagamento -->
<div id="modal-pagamento-spedizione-overlay" class="overlay" onclick="togglePagamentoSpedizioneModal()"></div>
<!--tasto app -->
<div id="app-modal" class="modal">
  <h3>Come installare l'app</h3>
  <p><strong>Su Android (Chrome):</strong><br>
    1. Apri il sito nel browser<br>
    2. Tocca ⋮ in alto a destra<br>
    3. Seleziona <em>"Aggiungi a schermata Home"</em><br>
    4. Conferma. Fatto! ✅
  </p>
  <p><strong>Su iPhone (Safari):</strong><br>
    1. Apri il sito nel browser Safari<br>
    2. Tocca l'icona <span style="font-size:1.2em;">📤</span> in basso<br>
    3. Seleziona <em>"Aggiungi alla schermata Home"</em><br>
    4. Tocca "Aggiungi". Tutto fatto! ✅
  </p>
  <button onclick="toggleAppModal()" style="background: #6e3b6e; color: white; padding: 0.8rem; border: none; border-radius: 5px; cursor: pointer;"><i class="fas fa-times-circle"></i> Chiudi</button>
</div>
<div id="app-overlay" class="overlay" onclick="toggleAppModal()"></div>
<button onclick="scrollToTop()" id="scroll-top-btn" class="btn-scroll-top" aria-label="Vai Su" title="Vai Su">
  <i class="fas fa-arrow-up"></i>
</button>
<!-- LIGHTBOX IMMAGINI (in fondo al body) -->
<div id="img-lightbox" class="img-lightbox" aria-hidden="true" role="dialog" aria-label="Galleria immagini">
  <button id="lb-close" class="lb-close" aria-label="Chiudi galleria">✕</button>
  <div id="lb-slider" class="lb-slider" aria-live="polite">
    <div class="lb-slide"><img id="lb-img-0" src="immagine-non-disponibile.webp" alt="Foto principale dell'articolo"></div>
    <div class="lb-slide"><img id="lb-img-1" src="immagine-non-disponibile.webp" alt="Foto aggiuntiva dell'articolo"></div>
  </div>
  <div id="lb-indicator" class="lb-indicator" aria-hidden="true">1 / 2</div>
</div>
<footer class="footer">
  &copy; 2025 il bAzAr LaMuBy - Tutti i diritti riservati
  <span class="piva">P.IVA 04692000989</span>
</footer> 
<script> 
let ultimaPosizioneScroll = 0; 
document.getElementById("home-btn").style.display = "none";  
function toggleModal() {
  const modal = document.getElementById('modal');
  const overlay = document.getElementById('overlay');
  modal.classList.toggle('active');
  overlay.classList.toggle('active');
  if (modal.classList.contains('active')) {
    document.body.classList.add("overlay-attivo"); // 👈 aggiunto
    bloccaScroll()
  } else {
    document.body.classList.remove("overlay-attivo"); // 👈 rimosso
    sbloccaScroll()
  }
  apriModaleAnimato("modal", "fade");
}
    function mostraDettaglio(titolo, descrizione, img1, img2, prezzo,badge) {
		ultimaPosizioneScroll = window.scrollY; // Salva la posizione corrente
		window.scrollTo(0, 0); // Porta subito la pagina all'inizio
		document.getElementById('search').style.display = 'none'; // nascondi la barra
		document.getElementById('clear-search').style.display = 'none'; // nascondi la x
		document.getElementById("titolo-home").style.display = "none";
		document.getElementById("home-btn").style.display = "inline-block";
		document.getElementById("ordina-prezzo-btn").style.display = "none";
		document.querySelector('.products').style.display = 'none';		
		 let dettaglio = document.getElementById('dettaglio-articolo');
    dettaglio.style.display = 'block';
    // Aggiunge l'animazione
    setTimeout(() => {
        dettaglio.classList.add('active');
    }, 50);			
		document.getElementById('dettaglio-articolo').style.display = 'block';
		document.getElementById('titolo-articolo').textContent = titolo;
		document.getElementById('badge-articolo').textContent = badge;
		document.getElementById('descrizione-articolo').innerHTML = descrizione;
		document.getElementById('descrizione-articolo').classList.add('descrizione-scarabocchio');
		document.getElementById('foto1-articolo').src = img1;
		document.getElementById('foto2-articolo').src = img2;
		document.getElementById('prezzo-articolo').textContent = prezzo;		
	}	
document.getElementById("share-btn").onclick = function () {
  const sito = 'Il bAzAr LaMuBy'
  const titolo = document.getElementById("titolo-articolo").textContent.trim();
  const descrizione = document.getElementById("descrizione-articolo").textContent.trim();
  const prezzo = document.getElementById("prezzo-articolo").textContent.trim();
  // Link al dettaglio dell'articolo con parametro ?item=
  const url = `${window.location.origin}${window.location.pathname}?item=${encodeURIComponent(titolo)}`;
  const messaggio = `*${sito}*\n\n🛍️ *${titolo}*\n\n💬 ${descrizione}\n💶 Prezzo: ${prezzo}\n🔗 ${url}`;
  if (navigator.share) {
    navigator.share({
      title: `Articolo: ${titolo}`,
      text: messaggio
    }).catch(err => console.error("Errore condivisione:", err));
  } else {
    prompt("Copia e condividi questo messaggio:", messaggio);
  }
};
 function tornaAllaHome() {
    document.getElementById('search').style.display = 'block'; // mostra la barra
	aggiornaClearBtn(); //  la X sarà visibile se c'è testo
	document.getElementById("home-btn").style.display = "none";
	document.getElementById("ordina-prezzo-btn").style.display = "inline-block";	
    let dettaglio = document.getElementById('dettaglio-articolo');    
    // Rimuove gradualmente l'animazione prima di nascondere il dettaglio
    dettaglio.classList.remove('active');
    setTimeout(() => {
        dettaglio.style.display = 'none';
        document.querySelector('.products').style.display = 'grid'; 
		window.scrollTo({ top: ultimaPosizioneScroll, behavior: 'auto' }); // Torna dove eri
  }, 500);
    document.getElementById("titolo-home").style.display = "block";
    window.scrollTo(0, 0); // Salta direttamente all'inizio della pagina	
	// ✅ Rimuove ?item=... dall'URL senza ricaricare la pagina
  if (window.history.replaceState) {
    const baseUrl = window.location.origin + window.location.pathname.replace(/index\.html$/, '');
    window.history.replaceState({}, document.title, baseUrl);
  }
	}
    function evidenzia(el) {
      el.classList.add("highlight");
      setTimeout(() => {
        el.classList.remove("highlight");
      }, 300);
    }
let carrello = [];
function aggiungiAlCarrello(nome, prezzo) {
    document.getElementById("suono-aggiunta").play().catch(e => console.warn("Audio non riproducibile:", e));
	let prezzoNumerico = parseFloat(prezzo.replace(/[^\d.]/g, ""));
    let articolo = carrello.find(item => item.nome === nome);
    if (articolo) {
        articolo.quantita++;
    } else {
        carrello.push({ nome, prezzo: prezzoNumerico, quantita: 1 });
    }
    salvaCarrelloLocalmente();
    aggiornaCarrello();
    // ✨ ANIMAZIONE ICONA FLY TO CART
    const event = window.event;
    const clickX = event.clientX;
    const clickY = event.clientY;
    const icona = document.createElement("div");
    icona.classList.add("fly-to-cart");
    icona.innerHTML = "📦"; // puoi usare 👻, 📦, 🎁, ✨, 💎, 🛍️, 🧺
    icona.style.left = `${clickX}px`;
    icona.style.top = `${clickY}px`;
    // Calcolo destinazione (posizione del carrello)
    const carrelloBtn = document.getElementById("carrello-btn");
    const rect = carrelloBtn.getBoundingClientRect();
    const dx = rect.left - clickX + 10;
    const dy = rect.top - clickY + 10;
    icona.style.setProperty("--dx", `${dx}px`);
    icona.style.setProperty("--dy", `${dy}px`);
    document.body.appendChild(icona);
    setTimeout(() => {
        icona.remove();
    }, 1000);
    // 🔔 TOAST NOTIFICATION
    let toast = document.getElementById("toast-confirm");
    toast.innerHTML = `<i class="fas fa-check-circle"></i> ${nome} aggiunto al carrello!`;
    toast.style.animationDuration = `2500ms`;
	toast.style.display = "block";
    toast.innerHTML += '<div id="toast-progress-bar"></div>';
	const barra = document.querySelector("#toast-progress-bar");
    barra.style.animationDuration = `2500ms`;
    setTimeout(() => {
        toast.style.display = "none";
    }, 2500);
    // bounce carrello
    carrelloBtn.style.animation = "bounce 1s ease-in-out 2";
    setTimeout(() => {
        carrelloBtn.style.animation = "";
    }, 2000);
}
function salvaCarrelloLocalmente() {
    if (carrello.length > 0) {
        localStorage.setItem("carrello", JSON.stringify(carrello));
    }
}
function aggiornaCarrello() {
    let carrelloContainer = document.getElementById("lista-carrello");
    carrelloContainer.innerHTML = "";
    let totalePrezzo = 0;
	if (carrello.length === 0) {
			const vuotoMsg = document.createElement("li");
			vuotoMsg.innerHTML = '(vuoto)';
			vuotoMsg.style.color = "gray";
			vuotoMsg.style.textAlign = "center";
			vuotoMsg.style.padding = "6px 0";
			carrelloContainer.appendChild(vuotoMsg);
		}
    carrello.forEach(item => {
        if (!isNaN(item.prezzo)) { // Controlla che il prezzo sia valido
            totalePrezzo += item.prezzo * item.quantita;
        }
        let li = document.createElement("li");
        li.innerHTML = `
  <div class="articolo-carrello-semplice">
    <span class="nome-articolo">${item.nome}</span>
    <span class="quantita-articolo">x${item.quantita}</span>
    <span class="prezzo-articolo">€${item.prezzo.toFixed(2)}</span>
    <button onclick="rimuoviDalCarrello('${item.nome}')" aria-label="Rimuovi articolo" title="Rimuovi articolo" class="icona-rimuovi">
      <i class="fas fa-trash-alt"></i>
    </button>
  </div>
`;
        carrelloContainer.appendChild(li);		
    });
    document.getElementById("contatore-carrello").textContent = carrello.reduce((sum, item) => sum + item.quantita, 0);    
    document.getElementById("contatore-carrello-modal").textContent = carrello.reduce((sum, item) => sum + item.quantita, 0);   
    document.getElementById("badge-carrello-small").textContent = carrello.reduce((sum, item) => sum + item.quantita, 0);
	document.getElementById("totale-prezzo").textContent = `Totale: €${totalePrezzo.toFixed(2)}`;    
    // Mostra o nasconde i pulsanti in base al contenuto del carrello
    let btnSvuota = document.getElementById("btn-svuota");
    let btnProcedi = document.getElementById("btn-procedi");    
    if (carrello.length === 0) {
        btnSvuota.style.display = "none";
        btnProcedi.style.display = "none";
    } else {
        btnSvuota.style.display = "block";
        btnProcedi.style.display = "block";
    }
}
function inviaOrdineWhatsApp() {
	let nome = document.getElementById("nome").value.trim();
    let indirizzo = document.getElementById("indirizzo").value.trim();
    let telefono = document.getElementById("telefono").value.trim();
    let email = document.getElementById("email").value.trim();
    let carrelloSalvato = localStorage.getItem("carrello");
    if (!carrelloSalvato || JSON.parse(carrelloSalvato).length === 0) {
        alert("Il carrello è vuoto, impossibile inviare l'ordine!");
        return;
    }
    let ordine = JSON.parse(carrelloSalvato);
    let totalePrezzo = ordine.reduce((sum, item) => sum + item.prezzo * item.quantita, 0);
    let nomeUtente = localStorage.getItem("nomeUtente");
	let messaggio;
	if (nomeUtente && nomeUtente.trim() !== "") {
		messaggio = `*Nuovo Ordine* da *${nomeUtente}* \n\n Nome: ${nome}\n Indirizzo: ${indirizzo}\n Telefono: ${telefono}\n Email: ${email}\n\n *Prodotti Ordinati:* \n`;
	} else {
		messaggio = `*Nuovo Ordine* \n\n Nome: ${nome}\n Indirizzo: ${indirizzo}\n Telefono: ${telefono}\n Email: ${email}\n\n *Prodotti Ordinati:* \n`;
	}
	ordine.forEach(item => {
		messaggio += `- ${item.nome} | €${item.prezzo.toFixed(2)} x ${item.quantita}\n`;
	});
	messaggio += `\n *Totale Ordine:* €${totalePrezzo.toFixed(2)}\n\n Grazie per l'acquisto! `;
    let numeroWhatsApp = "3516100235"; // Sostituisci con il numero destinatario
    let urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(messaggio)}`;
    let toast = document.getElementById("toast-confirm");
	toast.innerHTML = `<i class="fab fa-whatsapp"></i> Apro WhatsApp:ricordati di premere“Invia”!😉`;
	toast.style.animationDuration = `2000ms`;
	toast.style.display = "block";
	toast.innerHTML += '<div id="toast-progress-bar"></div>';
	const barra = document.querySelector("#toast-progress-bar");
    barra.style.animationDuration = `2000ms`;
	// ✅ Attendi un attimo prima di aprire WhatsApp
	setTimeout(() => {
		window.open(urlWhatsApp, "_blank");
		// Mostra il popup di conferma ordine
		mostraPopupConferma();
	}, 2000);
	// Nasconde il toast dopo 2 secondi
	setTimeout(() => {
		toast.style.display = "none";
	}, 2000);    
	// Salva l'ordine in localStorage
let ordiniSalvati = JSON.parse(localStorage.getItem("ordini")) || [];
let nuovoOrdine = {
  data: new Date().toLocaleString(),
  nome,
  indirizzo,
  telefono,
  email,
  prodotti: ordine,
  totale: totalePrezzo.toFixed(2)
};
ordiniSalvati.push(nuovoOrdine);
localStorage.setItem("ordini", JSON.stringify(ordiniSalvati));
    // Svuota il carrello dopo l'invio
    svuotaCarrello();
}
function mostraCarrello() {
    document.getElementById("modal-carrello").classList.add("active");
    document.getElementById("overlay-carrello").classList.add("active");
	document.body.classList.add("overlay-attivo"); // 👈 aggiunto
	bloccaScroll()
	apriModaleAnimato("modal-carrello" , "fade");
}
function chiudiCarrello() {
    document.getElementById("modal-carrello").classList.remove("active");
    document.getElementById("overlay-carrello").classList.remove("active");
	document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
}
function svuotaCarrello() {
    carrello = [];
    localStorage.removeItem("carrello"); // Cancella i dati salvati
    aggiornaCarrello();
}
function rimuoviDalCarrello(nome) {
    let articolo = carrello.find(item => item.nome === nome);
    if (articolo) {
        if (articolo.quantita > 1) {
            articolo.quantita--;
        } else {
            carrello = carrello.filter(item => item.nome !== nome);
        }
    }
    salvaCarrelloLocalmente();
    aggiornaCarrello();
}
function caricaCarrello() {
    localStorage.removeItem("carrello"); // Cancella i dati salvati all'avvio
    carrello = []; // Resetta la variabile
    aggiornaCarrello(); // Assicura che i pulsanti siano gestiti correttamente
}
window.onload = function() {
   	const salvato = localStorage.getItem("carrello");
  if (salvato) {
    try {
      carrello = JSON.parse(salvato);
    } catch (e) {
      console.error("Errore nel parsing del carrello:", e);
      carrello = [];
    }
  } else {
    carrello = [];
  }
    aggiornaCarrello(); // Assicura che i pulsanti vengano gestiti correttamente
};
function mostraModuloSpedizione() {
	chiudiCarrello(); // Chiude il carrello
    document.getElementById("modal-spedizione").style.display = "block";
	document.getElementById("overlay-carrello").classList.add("active"); // Applica overlay oscurante
	document.body.classList.add("overlay-attivo"); // 👈 aggiunto
	bloccaScroll()
	apriModaleAnimato("modal-spedizione" , "fade");
}
function chiudiModuloSpedizione() {
    document.getElementById("modal-spedizione").style.display = "none";
    document.getElementById("overlay-carrello").classList.remove("active"); // Rimuove overlay oscurante
    document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
}
function mostraPopupConferma() {
    // Chiudi il carrello
    document.getElementById("modal-carrello").classList.remove("active");
    document.getElementById("overlay-carrello").classList.remove("active");
    // Chiudi la finestra di spedizione
    document.getElementById("modal-spedizione").style.display = "none";	
	// Chiudi la finestra di riepilogo
	document.getElementById("modal-riepilogo").style.display = "none";
    // Mostra la conferma dell'ordine
    document.getElementById("popup-conferma").style.display = "block";
    document.getElementById("overlay-conferma").classList.add("active"); //  attiva oscurante
    document.body.classList.add("overlay-attivo"); // 👈 aggiunto
	bloccaScroll()
}
function chiudiPopupAnnullato() {
    document.getElementById("popup-annullato").style.display = "none";
	document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
	mostraCarrello();
}
function chiudiPopupConferma() {
    svuotaCarrello(); // Svuota il carrello quando si chiude il popup
    document.getElementById("overlay-conferma").classList.remove("active"); //  disattiva overlay
    document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
	location.reload(); // Ricarica la pagina manualmente
}
let clickCounter = 0;
const logo = document.querySelector(".logo");
const modal = document.getElementById("easter-egg-modal");
logo.addEventListener("click", function() {
    clickCounter++;    
    if (clickCounter === 5) {
    modal.style.display = "block";
	bloccaScroll()
	apriModaleAnimato("easter-egg-modal" , "fade");
    document.getElementById("overlay-easteregg").classList.add("active");
    startFireworks(); //  AVVIO
    clickCounter = 0;
}
});
function chiudiModal() {
    modal.style.display = "none";
    document.getElementById("overlay-easteregg").classList.remove("active");
    document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
}
function toggleAppModal() {
  const modal = document.getElementById("app-modal");
  const overlay = document.getElementById("app-overlay");  
  modal.classList.toggle("active");
  overlay.classList.toggle("active");
  if (modal.classList.contains("active")) {
    document.body.classList.add("overlay-attivo"); // 👈 aggiunto
	bloccaScroll()
  } else {
    document.body.classList.remove("overlay-attivo"); // 👈 rimosso
	sbloccaScroll()
  }
  apriModaleAnimato("app-modal", "fade");
}
  if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('Service Worker registrato', reg))
          .catch(err => console.error('Errore Service Worker', err));
      });
    }
const canvas = document.getElementById("fireworks-canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let fireworks = [];
function createFirework() {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height / 2;
    const colors = ["#ff0043", "#00ffae", "#ffff00", "#00aaff", "#ff9900"];
    for (let i = 0; i < 50; i++) {
        fireworks.push({
            x,
            y,
            radius: Math.random() * 2 + 1,
            angle: Math.random() * 2 * Math.PI,
            speed: Math.random() * 5 + 1,
            alpha: 1,
            color: colors[Math.floor(Math.random() * colors.length)]
        });
    }
}
function updateFireworks() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    fireworks.forEach((f, i) => {
        f.x += Math.cos(f.angle) * f.speed;
        f.y += Math.sin(f.angle) * f.speed;
        f.alpha -= 0.01;
        if (f.alpha <= 0) fireworks.splice(i, 1);
        else {
            ctx.globalAlpha = f.alpha;
            ctx.beginPath();
            ctx.arc(f.x, f.y, f.radius, 0, 2 * Math.PI);
            ctx.fillStyle = f.color;
            ctx.fill();
        }
    });
    ctx.globalAlpha = 1;
    requestAnimationFrame(updateFireworks);
}
function startFireworks() {
    canvas.style.display = "block";
    const interval = setInterval(createFirework, 400);
    updateFireworks();
    setTimeout(() => {
        clearInterval(interval);
        setTimeout(() => canvas.style.display = "none", 2000);
    }, 3000);
}
// Mostra il tasto solo quando si scrolla verso il basso
window.addEventListener("scroll", function() {
  const btn = document.getElementById("scroll-top-btn");
  const dettaglio = document.getElementById("dettaglio-articolo");
  if (!btn || !dettaglio) return;
  const dettaglioAttivo = dettaglio.classList.contains("active") || dettaglio.style.display === "block";
  if (window.scrollY > 300 && !dettaglioAttivo) {
    btn.style.display = "block";
  } else {
    btn.style.display = "none";
  }
});
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function togglePolicyModal() {
  window.scrollTo(0, 0);
  const modal = document.getElementById("modal-policy");
  const overlay = document.getElementById("policy-overlay");
  modal.classList.toggle("active");
  overlay.classList.toggle("active");
  if (modal.classList.contains("active")) {
    document.body.classList.add("overlay-attivo"); // 👈 aggiunto
	document.body.classList.add("noscroll");  // Blocca lo scroll della pagina
  } else {
  document.getElementById("modal").classList.remove("active");
  document.getElementById("overlay").classList.remove("active");
  document.body.classList.remove("overlay-attivo"); // 👈 rimosso
    document.body.classList.remove("noscroll");  // Sblocca lo scroll
  }
  apriModaleAnimato("modal-policy", "fade");
}
fetch('articoli.json')
  .then(response => response.json())
  .then(articoli => {
  window.articoliOriginali = [...articoli];
  window.articoliCorrenti = [...articoli];
    const container = document.querySelector('.products');
    const preferiti = JSON.parse(localStorage.getItem('preferiti')) || [];
	    // Leggi il carrello salvato
    let carrelloSalvato = JSON.parse(localStorage.getItem("carrello")) || [];
    // Crea una lista dei titoli validi
    const titoliDisponibili = articoli.map(a => a.titolo);
    // Filtra il carrello mantenendo solo gli articoli ancora presenti
    carrelloSalvato = carrelloSalvato.filter(item => titoliDisponibili.includes(item.nome));
    // Salva di nuovo il carrello filtrato
    localStorage.setItem("carrello", JSON.stringify(carrelloSalvato));
    // Aggiorna la variabile globale carrello (se serve)
    carrello = carrelloSalvato;
    // Aggiorna la UI
    aggiornaCarrello();
let preferitiPuliti = preferiti.filter(titolo => titoliDisponibili.includes(titolo));
localStorage.setItem('preferiti', JSON.stringify(preferitiPuliti));
preferiti.length = 0;
preferiti.push(...preferitiPuliti);
// Aggiorna l’icona cuore (🤍/❤️) in alto a destra
aggiornaStatoCuore();
aggiornaListaPreferiti(articoli);
// 🔗 Mostra dettaglio articolo se URL contiene ?item=
const urlParams = new URLSearchParams(window.location.search);
const articoloRichiesto = urlParams.get("item");
if (articoloRichiesto) {
  const articolo = articoli.find(a => a.titolo === articoloRichiesto);
  if (articolo) {
    mostraDettaglio(
      articolo.titolo,
      articolo.descrizione,
      articolo.foto1,
      articolo.foto2,
      articolo.prezzo,
      articolo.badge
    );
  }
}
renderArticoli(window.articoliCorrenti);    
  })
  .catch(error => console.error('Errore nel caricamento articoli:', error));
function aggiornaListaPreferiti(articoli) {
  const lista = document.getElementById('lista-preferiti');
  if (!lista) return;
  const preferiti = JSON.parse(localStorage.getItem('preferiti')) || [];
  lista.innerHTML = '';
  // Filtra articoli validi
  const articoliPreferitiValidi = preferiti
    .map(titolo => articoli.find(a => a.titolo === titolo))
    .filter(Boolean);
  if (articoliPreferitiValidi.length === 0) {
    const vuoto = document.createElement('li');
    vuoto.textContent = "Nessun preferito 😔";
    lista.appendChild(vuoto);
    return;
  }
  articoliPreferitiValidi.forEach(articolo => {
    const li = document.createElement('li');
    li.textContent = articolo.titolo;
    li.style.cursor = 'pointer';
    li.style.color = '#fff';
    li.addEventListener('click', () => {
      mostraDettaglio(
        articolo.titolo,
        articolo.descrizione,
        articolo.foto1,
        articolo.foto2,
        articolo.prezzo,
        articolo.badge
      );
      document.getElementById('sidebar').classList.remove('active');
      document.getElementById('sidebar-overlay').classList.remove('active');
    });
    lista.appendChild(li);
  });
}
 window.addEventListener("DOMContentLoaded", () => {
    const emailBase64 = "bGF1cmEucGlvdmFuZWxsaTE5ODRAZ21haWwuY29t";
    const telefonoBase64 = "MzUxNjEwMDIzNQ==";
    const email = atob(emailBase64);
    const telefono = atob(telefonoBase64);
    const emailEl = document.getElementById("emailpersonale");
    const telefonoEl = document.getElementById("telefonopersonale");
    const telCarrello = document.getElementById("telefonocarrello"); /* non piu usato era per salvare numero in rubrica */
    if (emailEl && telefonoEl) {
      emailEl.textContent = email;
      telefonoEl.textContent = telefono;
    } else {
      console.warn("Elementi contatto non trovati nel DOM.");
    }
    if (telCarrello) {
		telCarrello.textContent = telefono;
	}	
  const nomeEl = document.getElementById("nome-utente");
  const salutoLabel = document.getElementById("saluto-label");
  const usernameSpan = document.getElementById("username-dinamico");
  const nomeSalvato = localStorage.getItem("nomeUtente");
  const nomeAppenaInserito = localStorage.getItem("nomeAppenaInserito");
  const nomeModificato = localStorage.getItem("nomeModificato");  /*serve per reset preferiti e ordini */
  if (nomeSalvato) {
    usernameSpan.textContent = nomeSalvato;
    if (nomeAppenaInserito === "true") {
      salutoLabel.textContent = "Benvenuto/a";
    } else {
      salutoLabel.textContent = "Bentornato/a";
	  document.getElementById("icona-modifica").style.display = "none";
	  localStorage.setItem("nomeModificato", "true"); /*serve per reset preferiti e ordini */
    }
  }
  // 🔁 Disattiva subito il flag dopo l'uso
  if (nomeAppenaInserito === "true") {
    localStorage.setItem("nomeAppenaInserito", "false");
  }  
    nomeEl.addEventListener("click", () => {
	let nuovoNome;
if (localStorage.getItem("nomeModificato") === "true") {
  nuovoNome = prompt("✨Nuovo nome? (⚠️ reset preferiti/ordini)");
} else {
  nuovoNome = prompt("Prima volta?! Scegli il tuo nickname ✨");
}
    if (nuovoNome) {
		if (localStorage.getItem("nomeModificato") === "true") {
			localStorage.removeItem("preferiti");
			localStorage.removeItem("ordini");
			localStorage.removeItem("datiSpedizione");
			// opzionale: svuota i campi
			 // Recupero dell'elemento h4 prima di modificarlo
			const h4Spedizione = document.querySelector('#modal-spedizione h4');
			if (h4Spedizione) h4Spedizione.textContent = "";
			document.getElementById("nome").value = "";
			document.getElementById("indirizzo").value = "";
			document.getElementById("telefono").value = "";
			document.getElementById("email").value = "";			
		}      
	  localStorage.setItem("nomeUtente", nuovoNome);
      localStorage.setItem("nomeAppenaInserito", "false");
      usernameSpan.textContent = nuovoNome;
      salutoLabel.textContent = "Benvenuto/a";
	  document.getElementById("icona-modifica").style.display = "none";
	  localStorage.setItem("nomeModificato", "true");  /*serve per reset preferiti e ordini */
       // ✅ Aggiorna subito preferiti e ordini nella UI
    aggiornaListaPreferiti(window.articoliOriginali); // aggiorna lista preferiti
    aggiornaStatoCuore(); // aggiorna icona cuore
    const listaOrdini = document.getElementById("lista-ordini");
    if (listaOrdini && listaOrdini.style.display !== "none") {
      mostraOrdini(); // aggiorna lista visiva se è aperta
    }	
	// ✅ Aggiorna pulsanti ❤️/🤍 negli articoli della home
    renderArticoli(window.articoliCorrenti);
	}
  });
});
  const toggleSidebar = document.getElementById('toggle-sidebar');
  const sidebar = document.getElementById('sidebar');
  const closeSidebar = document.getElementById('close-sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  toggleSidebar.addEventListener('click', () => {
    sidebar.classList.add('active');
    overlay.classList.add('active');
  });
  closeSidebar.addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
  });
  overlay.addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
  });
document.addEventListener("DOMContentLoaded", function () {
    aggiornaStatoCuore();
	const dettaglio = document.getElementById("dettaglio-articolo");
    const toggleBtn = document.getElementById("toggle-sidebar");
    if (dettaglio && toggleBtn) {
      const observer = new MutationObserver(() => {
        if (dettaglio.classList.contains("active")) {
          toggleBtn.style.display = "none";
        } else {
          toggleBtn.style.display = "block";
        }
      });
      observer.observe(dettaglio, { attributes: true });
    }
	inizializzaSpedizione();
  });
function aggiornaStatoCuore() {
  const toggleBtn = document.getElementById('toggle-sidebar');
  const preferiti = JSON.parse(localStorage.getItem('preferiti')) || [];
  if (toggleBtn) {
    if (preferiti.length > 0) {
      toggleBtn.classList.remove('vuoto');
      toggleBtn.classList.add('pieno');
      toggleBtn.textContent = '❤️';
    } else {
      toggleBtn.classList.remove('pieno');
      toggleBtn.classList.add('vuoto');
      toggleBtn.textContent = '🤍';
    }
  }
}
const searchInput = document.getElementById('search');
searchInput.addEventListener('keyup', function () {
  const query = searchInput.value.trim().toLowerCase();
  const filtrati = window.articoliOriginali.filter(art => {
    const testo = (art.titolo + " " + art.descrizione).toLowerCase();
    return testo.includes(query);
  });
  // aggiorna la lista attuale usata anche dal sort
  window.articoliCorrenti = filtrati;
  renderArticoli(filtrati);
  document.getElementById("ordina-prezzo-btn").innerHTML =
  '<i class="fas fa-long-arrow-alt-up"><sup>€</sup></i>';
ordinePrezzoAttivo = false;
});
const searchField = document.getElementById('search');
const clearBtn = document.getElementById('clear-search');
searchField.addEventListener('input', () => {
  clearBtn.style.display = searchField.value ? 'block' : 'none';
});
clearBtn.addEventListener('click', () => {
  searchField.value = '';
  clearBtn.style.display = 'none';
  // Trigger manualmente l’evento keyup per riattivare il filtro prodotti
  const event = new Event('keyup');
  searchField.dispatchEvent(event);
});
function aggiornaClearBtn() {
  clearBtn.style.display = searchField.value ? 'block' : 'none';
}
let ordinePrezzoAttivo = false;
function toggleOrdinaPrezzo() {
  ordinePrezzoAttivo = !ordinePrezzoAttivo;
  if (ordinePrezzoAttivo) {
    // Ordina per prezzo crescente
    const ordinati = [...window.articoliCorrenti].sort((a, b) => {
      const prezzoA = parseFloat(a.prezzo.replace(/[^\d,]/g, "").replace(",", "."));
      const prezzoB = parseFloat(b.prezzo.replace(/[^\d,]/g, "").replace(",", "."));
      return prezzoA - prezzoB;
    });
    document.getElementById("ordina-prezzo-btn").innerHTML =
      '&nbsp<i class="fas fa-sort">&nbsp</i>';
    renderArticoli(ordinati);
  } else {
    // Ripristina l’ordine originale della ricerca (non ordinato per prezzo)
    document.getElementById("ordina-prezzo-btn").innerHTML =
      '<i class="fas fa-long-arrow-alt-up"><sup>€</sup></i>';
    renderArticoli(window.articoliCorrenti);
  }
}
function aggiornaContatoreArticoli(lista) {
  const contatore = document.getElementById("contatore-articoli");
  if (contatore) {
    const isSearchAttiva = document.getElementById("search")?.value.trim() !== "";
    const asterisco = isSearchAttiva ? "✱" : "";
    contatore.textContent = `(${lista.length}${asterisco})`;
  }
}		
function renderArticoli(articoli) {
  const container = document.querySelector('.products');
  const preferiti = JSON.parse(localStorage.getItem('preferiti')) || [];
  container.innerHTML = "";
  articoli.forEach(articolo => {
    const div = document.createElement('div');
    div.className = 'product';
    div.style.position = 'relative';
    div.setAttribute('ontouchstart', 'evidenzia(this)');
    div.setAttribute('onclick', `mostraDettaglio('${articolo.titolo}', '${articolo.descrizione.replace(/'/g, "\\'")}', '${articolo.foto1}', '${articolo.foto2}', '${articolo.prezzo}', '${articolo.badge}')`);
    const isPreferito = preferiti.includes(articolo.titolo);
    const cuore = isPreferito ? '❤️' : '🤍';
    div.innerHTML = `
      <div style="position: absolute; top: 0; left: 0; background-color: #6e3b6e; color: white; font-size: 0.7rem; padding: 4px 10px; font-weight: bold; border-bottom-right-radius: 8px;">${articolo.badge}</div>
      <button class="btn-preferito" style="position: absolute; top: 5px; right: 5px; background: none; border: none; font-size: 1.4rem; cursor: pointer; z-index: 10;">${cuore}</button>
      <img src="${articolo.foto1}" alt="${articolo.titolo}" fetchpriority="high">
      <h2>${articolo.titolo}</h2>
      <p class="price"><strong>${articolo.prezzo}</strong></p>
      <p class="descrizione-scarabocchio">${articolo.descrizione}</p>
	  <p class="visualizza-articolo">Visualizza articolo</p>
    `;
    const btn = div.querySelector('.btn-preferito');
    btn.addEventListener('click', function (e) {
      e.stopPropagation();
      const index = preferiti.indexOf(articolo.titolo);
      const toggleBtn = document.getElementById('toggle-sidebar');
      if (index > -1) {
        preferiti.splice(index, 1);
        btn.textContent = '🤍';
      } else {
        preferiti.push(articolo.titolo);
        btn.textContent = '❤️';
        if (toggleBtn) {
          toggleBtn.classList.add('pulsante-pulsante');
          setTimeout(() => toggleBtn.classList.remove('pulsante-pulsante'), 600);
        }
      }
      localStorage.setItem('preferiti', JSON.stringify(preferiti));
      aggiornaStatoCuore();
      aggiornaListaPreferiti(articoli);
    });
    container.appendChild(div);
  });
  aggiornaListaPreferiti(articoli);
  aggiornaStatoCuore();
  aggiornaContatoreArticoli(articoli);
}
function mostraOrdini() {
  const lista = document.getElementById("lista-ordini");
  lista.innerHTML = ""; // pulisce la lista
  const ordini = JSON.parse(localStorage.getItem("ordini")) || [];
  if (ordini.length === 0) {
    lista.innerHTML = "<li>Nessun ordine 😔</li>";
    return;
  }
  ordini.reverse().forEach((ordine, index) => {
    const numeroOrdine = ordini.length - index;
    const prodottiHTML = ordine.prodotti
      .map(p => `<li>${p.nome} x${p.quantita}</li>`)
      .join("");
    const contenuto = `
      <div style="
        margin-bottom: 10px;
        padding: 5px;
        background: #6e3b6e;
        border-radius: 6px;
      ">
        <strong>Ordine #${numeroOrdine}</strong><br>
        📅 ${ordine.data}<br>
        💶 Totale: €${ordine.totale}<br>
        📦 Prodotti:
        <ul style="padding-left: 1rem;">
          ${prodottiHTML}
        </ul>
      </div>
    `;
    const li = document.createElement("li");
    li.innerHTML = contenuto;
    lista.appendChild(li);
  });
}
function toggleOrdini() {
  const lista = document.getElementById("lista-ordini");
  const freccia = document.getElementById("freccia");
  if (lista.style.display === "none" || lista.style.display === "") {
    mostraOrdini(); 
    lista.style.display = "block";
    freccia.textContent = "⬆️";
  } else {
    lista.style.display = "none";
    freccia.textContent = "⬇️";
  }
}
// ⏳ INATTIVITÀ
let inattivitaTimer;
// Reset timer su ogni attività
function resetInattivitaTimer() {
  clearTimeout(inattivitaTimer);
  inattivitaTimer = setTimeout(() => {
    mostraToast("Tutto ok? Ti aspettiamo 👋");
  }, 2 * 60 * 1000); // 2 minuti
}
// 👁️ VISIBILITY: torna da background
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) {
    // Quando torna visibile
    mostraToast("Bentornato/a! 👋");
    resetInattivitaTimer();
  } else {
    clearTimeout(inattivitaTimer); // ferma il timer mentre è via
  }
});
// Eventi che contano come "attività"
["mousemove", "keydown", "touchstart", "scroll"].forEach(evento => {
  window.addEventListener(evento, resetInattivitaTimer);
});
// Avvio iniziale
resetInattivitaTimer();
// 📢 Funzione toast riutilizzabile
function mostraToast(messaggio) {
  const toast = document.getElementById("toast-confirm");
  if (!toast) return;
  // 🚫 NON mostrare il toast se il popup conferma è visibile
  const confermaVisibile = document.getElementById("popup-conferma")?.style.display === "block";
  if (confermaVisibile) return;
  // Posizione: sempre in basso a destra per ora
  toast.style.top = "";
  toast.style.bottom = "20px";
  toast.style.right = "20px";
  toast.style.left = "";
  toast.innerHTML = `${messaggio}`;
  toast.style.animationDuration = `3000ms`;  
  toast.style.display = "block";  
  toast.innerHTML += '<div id="toast-progress-bar"></div>';
  const barra = document.querySelector("#toast-progress-bar");
  barra.style.animationDuration = `3000ms`;
  setTimeout(() => {
    toast.style.display = "none";
  }, 3000);
}
function apriModaleAnimato(id, tipo = "slide") {
  const modale = document.getElementById(id);
  if (!modale) return;
  // Rimuove tutte le classi di animazione
  modale.classList.remove("slide-up", "fade-in", "zoom-in");
  // Forza il repaint per riavviare l’animazione
  void modale.offsetWidth;
  // Applica la giusta animazione
  switch (tipo) {
    case "fade":
      modale.classList.add("fade-in");
      break;
    case "zoom":
      modale.classList.add("zoom-in");
      break;
    default:
      modale.classList.add("slide-up");
  }
}
function apriRiepilogo() {
	let nome = document.getElementById("nome").value.trim();
    let indirizzo = document.getElementById("indirizzo").value.trim();
    let telefono = document.getElementById("telefono").value.trim();
    let email = document.getElementById("email").value.trim();
    const nomeRegex = /^[A-Za-zÀ-ÖØ-öø-ÿ'’-]{3,}\s+[A-Za-zÀ-ÖØ-öø-ÿ'’-]{3,}(?:\s+.*)?$/;
	const indirizzoRegex = /^.*[a-zA-Z]+\s+\d+\s+.*\s+\d{5}$/;
	const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const telefonoRegex = /^[0-9+\s]{9,15}$/;	
	if (!nome || !indirizzo || !telefono || !email) {
        alert("⚠️Per continuare, è necessario inserire tutte le informazioni.");
        return;
    }
	if (!nomeRegex.test(nome)) {
		alert("⚠️Inserisci nome e cognome validi (almeno 3 lettere ciascuno).");
		return;
	}
	if (!indirizzoRegex.test(indirizzo)) {
		alert("⚠️Inserisci un indirizzo completo (es. Via Rossi 10 Milano MI 20100)");
		return;
	}
	if (!telefonoRegex.test(telefono)) {
		alert("⚠️Inserisci un numero di telefono valido.");
		return;
	}
	if (!emailRegex.test(email)) {
		alert("⚠️Inserisci un'email valida.");
		return;
	}
  document.getElementById("riepilogo-nome").textContent = nome;
  document.getElementById("riepilogo-indirizzo").textContent = indirizzo;
  document.getElementById("riepilogo-telefono").textContent = telefono;
  document.getElementById("riepilogo-email").textContent = email;  
  // Aggiungi questa riga in alto per recuperare lo stato del checkbox
const salvaDati = document.getElementById("consenso-salvataggio")?.checked;
// Salvataggio dati spedizione SOLO se il consenso è attivo
if (salvaDati) {
  const dati = { nome, indirizzo, telefono, email };
  localStorage.setItem("datiSpedizione", JSON.stringify(dati));  
} else {
  localStorage.removeItem("datiSpedizione");
}  
  const carrelloSalvato = JSON.parse(localStorage.getItem("carrello")) || [];
  const lista = document.getElementById("riepilogo-lista-carrello");
  lista.innerHTML = "";
  let totale = 0;
  carrelloSalvato.forEach(item => {
    const li = document.createElement("li");
    li.innerHTML = `${item.nome} x${item.quantita} - €${item.prezzo.toFixed(2)}`;
    lista.appendChild(li);
    totale += item.prezzo * item.quantita;
  });
  document.getElementById("riepilogo-totale").textContent = `Totale: €${totale.toFixed(2)}`;
  document.getElementById("modal-spedizione").style.display = "none";
  document.getElementById("modal-riepilogo").style.display = "block";
  bloccaScroll()
  apriModaleAnimato("modal-riepilogo" , "fade");
}
function chiudiModuloRiepilogo() {
  document.getElementById("modal-riepilogo").style.display = "none";
  document.getElementById("popup-annullato").style.display = "block";
  sbloccaScroll()
  apriModaleAnimato("popup-annullato" , "fade");
}
function tornaAllaSpedizione() {
  document.getElementById("modal-riepilogo").style.display = "none";
  document.getElementById("modal-spedizione").style.display = "block";
  bloccaScroll()		
}
function inizializzaSpedizione() {
  const salvati = localStorage.getItem("datiSpedizione");
  const h4Spedizione = document.querySelector('#modal-spedizione h4');
  if (salvati) {
    try {
      const dati = JSON.parse(salvati);
      document.getElementById("nome").value = dati.nome || "";
      document.getElementById("indirizzo").value = dati.indirizzo || "";
      document.getElementById("telefono").value = dati.telefono || "";
      document.getElementById("email").value = dati.email || "";
      // ✅ Mostra messaggio se i dati sono validi
      if (dati.nome || dati.indirizzo || dati.telefono || dati.email) {
        h4Spedizione.textContent = "(Dati spedizione recuperati)";
      }
    } catch (e) {
      console.warn("Dati spedizione corrotti o non validi");
      h4Spedizione.textContent = ""; // rimuove il testo se errore
    }
  } else {
    // Nessun dato salvato → svuota il testo
    h4Spedizione.textContent = "";
  }
}
function copiaContatto(idElemento) {
  const testo = document.getElementById(idElemento)?.textContent?.trim();
  if (!testo) return;
  // Determina il tipo di contatto copiato
  let tipo = "";
  if (idElemento === "telefonopersonale") {
    tipo = "Telefono";
  } else if (idElemento === "emailpersonale") {
    tipo = "Email";
  }
  // Copia negli appunti
  navigator.clipboard.writeText(testo).then(() => {
    mostraToast(`✅${tipo} Copiato`);
  }).catch(() => {
    mostraToast("❌ Errore nella copia");
  });
}
function bloccaScroll() {
  document.body.classList.add("noscroll");
}
function sbloccaScroll() {
  document.body.classList.remove("noscroll");
}
function mostraLinkPagamento() {
  const totaleTesto = document.getElementById("riepilogo-totale")?.textContent || "";
  const totale = parseFloat(totaleTesto.replace(/[^\d.]/g, "")); // estrai solo numero
  if (isNaN(totale) || totale <= 0) {
    alert("Importo non valido per il pagamento.");
    return;
  }
  const usernamePayPal = "AntimoN"; // <-- cambia con il tuo PayPal.me
  const link = 'Ciao'      // `https://paypal.me/${usernamePayPal}/${totale.toFixed(2)}`;   
    // Copia negli appunti
  navigator.clipboard.writeText(link)
    .then(() => {
      console.log("Link copiato negli appunti:", link);
    })
    .catch(err => {
      console.warn("Impossibile copiare il link:", err);
    });
  // Conferma e apertura
  // if (confirm(`🅿️ Paga ora con PayPal\n${link}`)) { 
    // window.open(link, "_blank");
	alert("Link non disponibile al momento, scivere in chat WhatsApp.");
  // } 
}
function togglePagamentoSpedizioneModal() {
  window.scrollTo(0, 0);
  const modal = document.getElementById("modal-pagamento-spedizione");
  const overlay = document.getElementById("modal-pagamento-spedizione-overlay");  
  modal.classList.toggle("active");
  overlay.classList.toggle("active");
  if (modal.classList.contains("active")) {
    bloccaScroll()
  } else {
    sbloccaScroll()
  }
  apriModaleAnimato("modal-pagamento-spedizione", "fade");
}
// LIGHTBOX VANILLA (2 immagini) - pinch, pan, swipe, double-tap
(function(){
  const thumb1 = document.getElementById('foto1-articolo');
  const thumb2 = document.getElementById('foto2-articolo');
  const lb = document.getElementById('img-lightbox');
  const lbSlider = document.getElementById('lb-slider');
  const slidesImg = [ document.getElementById('lb-img-0'), document.getElementById('lb-img-1') ];
  const indicator = document.getElementById('lb-indicator');
  const closeBtn = document.getElementById('lb-close');
  if (!lb || !slidesImg[0] || !slidesImg[1]) return; // niente da fare
  let idx = 0;
  let scale = 1, lastScale = 1;
  let translate = {x:0, y:0}, lastTranslate = {x:0,y:0};
  let isPanning = false, panStart = null;
  let pinchStartDist = null;
  let swipeStartX = null;
  let lastTap = 0;
  function setSlidesSrc() {
    // prendi le src correnti (utile quando mostraDettaglio aggiorna le immagini)
    if (thumb1 && thumb1.src) slidesImg[0].src = thumb1.src;
    if (thumb2 && thumb2.src) slidesImg[1].src = thumb2.src;
    slidesImg.forEach((img,i)=>{ img.alt = `${document.getElementById('titolo-articolo')?.textContent || 'Immagine'} — foto ${i+1}`; });
  }
  function openLightbox(i){
    idx = i || 0;
    setSlidesSrc();
    resetTransforms();
    lb.classList.add('active');
    lb.setAttribute('aria-hidden','false');
    document.body.classList.add('noscroll');
    updateIndicator();
    // posiziona lo slider
    lbSlider.style.transform = `translateX(${ -idx * 100 }%)`;
  }
  function closeLightbox(){
    lb.classList.remove('active');
    lb.setAttribute('aria-hidden','true');
    document.body.classList.remove('noscroll');
    resetTransforms();
  }
  function updateIndicator(){
    indicator.textContent = `${idx+1} / ${slidesImg.length}`;
  }
  function resetTransforms(){
    scale = 1; lastScale = 1;
    translate = {x:0,y:0}; lastTranslate = {x:0,y:0};
    slidesImg.forEach(img => img.style.transform = `translate3d(0px,0px,0px) scale(1)`);
  }
  function applyTransform(){
    const img = slidesImg[idx];
    if(!img) return;
    const rect = img.getBoundingClientRect();
    const maxX = Math.max(0, (scale * rect.width - rect.width) / 2);
    const maxY = Math.max(0, (scale * rect.height - rect.height) / 2);
    // clamp
    translate.x = Math.max(-maxX, Math.min(maxX, translate.x));
    translate.y = Math.max(-maxY, Math.min(maxY, translate.y));
    img.style.transform = `translate3d(${translate.x}px, ${translate.y}px, 0px) scale(${scale})`;
  }
  // double-tap toggle
  function handleDoubleTap() {
    const now = Date.now();
    if (now - lastTap < 300) {
      if (scale > 1.05) { resetTransforms(); } 
      else { scale = 2.5; lastScale = scale; applyTransform(); }
    }
    lastTap = now;
  }
  // ========== TOUCH & MOUSE HANDLERS ==========
  lb.addEventListener('touchstart', function(e){
    if (!lb.classList.contains('active')) return;
    if (e.touches.length === 2) {
      pinchStartDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
      lastScale = scale;
    } else if (e.touches.length === 1) {
      const t = e.touches[0];
      if (scale > 1.05) {
        isPanning = true;
        panStart = { x: t.clientX, y: t.clientY };
        lastTranslate = { ...translate };
      } else {
        // possibile swipe
        swipeStartX = t.clientX;
      }
    }
  }, {passive:true});
  lb.addEventListener('touchmove', function(e){
    if (!lb.classList.contains('active')) return;
    if (e.touches.length === 2 && pinchStartDist) {
      const d = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
      const ratio = d / pinchStartDist;
      scale = Math.min(3, Math.max(1, lastScale * ratio));
      applyTransform();
      e.preventDefault();
    } else if (e.touches.length === 1 && isPanning && panStart) {
      const t = e.touches[0];
      translate.x = lastTranslate.x + (t.clientX - panStart.x);
      translate.y = lastTranslate.y + (t.clientY - panStart.y);
      applyTransform();
      e.preventDefault();
    }
  }, {passive:false});
  lb.addEventListener('touchend', function(e){
    // reset pinch/pan states
    if (e.touches.length === 0) {
      pinchStartDist = null;
      isPanning = false;
      panStart = null;
      // handle swipe (solo se non era zoomed)
      if (swipeStartX !== null && scale <= 1.05) {
        const changed = e.changedTouches && e.changedTouches[0];
        if (changed) {
          const dx = changed.clientX - swipeStartX;
          if (dx > 60 && idx > 0) { idx--; lbSlider.style.transform = `translateX(${ -idx * 100 }%)`; updateIndicator(); resetTransforms(); }
          if (dx < -60 && idx < slidesImg.length - 1) { idx++; lbSlider.style.transform = `translateX(${ -idx * 100 }%)`; updateIndicator(); resetTransforms(); }
        }
      }
      swipeStartX = null;
    }
    handleDoubleTap();
  }, {passive:true});
  // mouse pan support when zoomed
  let isMouseDown = false, mouseStart = null;
  lb.addEventListener('mousedown', (e) => {
    if (scale > 1.05) { isMouseDown = true; mouseStart = {x:e.clientX, y:e.clientY}; lastTranslate = {...translate}; }
  });
  window.addEventListener('mousemove', (e) => {
    if (!isMouseDown) return;
    translate.x = lastTranslate.x + (e.clientX - mouseStart.x);
    translate.y = lastTranslate.y + (e.clientY - mouseStart.y);
    applyTransform();
  });
  window.addEventListener('mouseup', ()=>{ isMouseDown = false; mouseStart = null; });
  // open via thumbnails (usiamo le img già presenti)
  if (thumb1) thumb1.addEventListener('click', (e)=>{ e.stopPropagation(); openLightbox(0); });
  if (thumb2) thumb2.addEventListener('click', (e)=>{ e.stopPropagation(); openLightbox(1); });
  // chiusura e click sullo sfondo
  closeBtn.addEventListener('click', closeLightbox);
  lb.addEventListener('click', function(e){ if (e.target === lb) closeLightbox(); });
  // keyboard navigation
  window.addEventListener('keydown', (e) => {
    if (!lb.classList.contains('active')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft' && idx > 0) { idx--; lbSlider.style.transform = `translateX(${ -idx * 100 }%)`; updateIndicator(); resetTransforms(); }
    if (e.key === 'ArrowRight' && idx < slidesImg.length - 1) { idx++; lbSlider.style.transform = `translateX(${ -idx * 100 }%)`; updateIndicator(); resetTransforms(); }
  });
  // se mostraDettaglio aggiorna le immagini, quando riapri il lightbox le prendiamo al volo (setSlidesSrc fa questo)
})();
	// Mostra loader all'avvio
document.getElementById("loader").style.display = "flex";
// Simulazione caricamento prodotti
window.addEventListener("load", function () {
  // Nasconde loader quando la pagina e le immagini sono pronte
  document.getElementById("loader").style.display = "none";
});
// Mostra/nascondi il carrello piccolo in base allo scroll
window.addEventListener("scroll", function() {
  const carrelloGrande = document.getElementById("carrello-btn");
  const carrelloSmall = document.getElementById("carrello-btn-small");
  const dettaglio = document.getElementById("dettaglio-articolo");
  if (!carrelloGrande || !carrelloSmall || !dettaglio) return;
  const rect = carrelloGrande.getBoundingClientRect();
  const headerVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;
  const dettaglioAttivo = dettaglio.classList.contains("active") || dettaglio.style.display === "block";
  if (headerVisible || dettaglioAttivo) {
    carrelloSmall.classList.remove("show");
  } else {
    carrelloSmall.classList.add("show");
  }
});
</script> 
<div id="overlay-easteregg" class="overlay"></div> 
<div id="overlay-conferma" class="overlay"></div>
<div id="overlay" class="overlay"></div>
<div id="toast-confirm"></div>
<div id="toast-progress-bar"></div> 
</body>
</html>
